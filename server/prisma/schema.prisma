generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Employee {
  id                         Int                  @id @default(autoincrement())
  name                       String
  supervisorId               Int?
  deskId                     Int?                 @unique
  image                      String?
  email                      String?              @unique
  password                   String?              @default("")
  createdAt                  DateTime             @default(now())
  position                   String?
  updatedAt                  DateTime             @default(now()) @updatedAt
  role                       Role                 @default(USER)
  phone                      Int                  @default(12345678)
  ActivityInvitationReceived ActivityInvitation[] @relation("InvitationsReceived")
  ActivityInvitationSent     ActivityInvitation[] @relation("InvitationsSent")
  desk                       Desk?                @relation(fields: [deskId], references: [id])
  supervisor                 Supervisor?          @relation(fields: [supervisorId], references: [id])
  response                   Response[]
}

model Supervisor {
  id        Int        @id @default(autoincrement())
  name      String?
  teamId    Int?
  image     String?
  email     String?    @unique
  password  String?
  createdAt DateTime   @default(now())
  position  String?
  updatedAt DateTime   @updatedAt
  role      Role       @default(USER)
  employees Employee[]
  Team      Team?      @relation(fields: [teamId], references: [id])
}

model Team {
  id         Int          @id @default(autoincrement())
  name       String
  roomId     Int?
  stageId    Int?
  image      String?
  product    String?
  supervisor Supervisor[]
  Room       Room?        @relation(fields: [roomId], references: [id])
  Stage      Stage?       @relation(fields: [stageId], references: [id])
}

model Building {
  id     Int     @id @default(autoincrement())
  name   String  @default("immeuble")
  stages Stage[]
}

model Stage {
  id         Int       @id @default(autoincrement())
  name       String
  buildingId Int?
  image      String    @default("")
  rooms      Room[]
  Building   Building? @relation(fields: [buildingId], references: [id])
  teams      Team[]
}

model Room {
  id      Int    @id @default(autoincrement())
  name    String
  stageId Int
  image   String @default("")
  desks   Desk[]
  Stage   Stage  @relation(fields: [stageId], references: [id])
  teams   Team[]
}

model Desk {
  id       Int       @id @default(autoincrement())
  name     String
  roomId   Int
  Room     Room      @relation(fields: [roomId], references: [id])
  employee Employee?
}

model Question {
  id          Int        @id @default(autoincrement())
  question    String
  category    String?
  abreviation String?
  response    Response[]
}

model Response {
  id         Int       @id @default(autoincrement())
  response   String?
  employeeId Int?
  questionId Int?
  Employee   Employee? @relation(fields: [employeeId], references: [id])
  Question   Question? @relation(fields: [questionId], references: [id])
}

model Activity {
  id          Int                  @id @default(autoincrement())
  type        String
  invitations ActivityInvitation[]
}

model ActivityInvitation {
  id          Int               @id @default(autoincrement())
  activityId  Int?
  senderId    Int?
  recipientId Int?
  hasRead     Boolean           @default(false)
  status      InvitationStatus? @default(PENDING)
  date        DateTime?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  activity    Activity?         @relation(fields: [activityId], references: [id])
  recipient   Employee?         @relation("InvitationsReceived", fields: [recipientId], references: [id])
  sender      Employee?         @relation("InvitationsSent", fields: [senderId], references: [id])
}

enum Role {
  ADMIN
  USER
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  DECLINED
}
